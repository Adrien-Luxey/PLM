<?xml version="1.0" encoding="UTF-8"?>
<project default="dist" name="JLM">

	<property name="base.dir" value="."/>
    <property name="dist.dir" value="${base.dir}/dist"/>
    <property name="lib.dir" value="${base.dir}/lib"/>
    <property name="classes.dir" value="${base.dir}/bin"/>
    <property name="src.dir" value="${base.dir}/src"/>
    <property name="site.dir" value="${base.dir}/site"/>

	<property file="${base.dir}/keystore.properties"/>

    <path id="project.class.path">
            <pathelement path="${classes.dir}"/>    
            <fileset dir="${lib.dir}">
                    <include name="**/*.jar"/>                      
            </fileset>      
    </path>

	<target name="clean" description="clean project">
		<delete dir="${classes.dir}"/>
		<delete dir="${dist.dir}"/>
		<delete dir="${site.dir}/lib"/>
	</target>

	<target name="compile" description="compile all source files">
        <mkdir dir="${classes.dir}"/>
        <javac classpathref="project.class.path" destdir="${classes.dir}" srcdir="${src.dir}" />        
	</target>	
	
	<target name="dist" depends="compile" description="build a standalone application jar file">
		<mkdir dir="${dist.dir}"/>
		<jar destfile="${dist.dir}/jlm.jar" filesetmanifest="mergewithoutmain">
			<manifest>
				<attribute name="Built-By" value="M. Quinson and G. Oster" />
				<attribute name="Main-Class" value="jlm.ui.JavaLearningMachine" />
				<attribute name="Class-Path" value="." />
			</manifest>
			<fileset dir="${classes.dir}" excludes="**/.gitignore **/*.java **/*.css **/*.html"/>
			<fileset dir="${src.dir}" includes="**/*.java **/*.html **/*.css **/*.png" excludes="**/.gitignore"/> 
			<fileset dir="${lib.dir}" excludes="*.jar"/>
			<zipfileset excludes="META-INF/*.SF" src="${lib.dir}/twitter4j-2.1.0-SNAPSHOT.jar" />
			<zipfileset excludes="META-INF/*.SF" src="${lib.dir}/jsyntaxpane-0.9.4.jar" />
			<zipfileset excludes="META-INF/*.SF" src="${lib.dir}/miglayout-3.6-swing.jar" />
			<zipfileset excludes="META-INF/*.SF" src="${lib.dir}/simple-xml-1.7.2.jar" />
			<zipfileset excludes="META-INF/*.SF" src="${lib.dir}/langtools-beta.jar" />
		</jar>
	</target>

	<target name="dist-web" depends="compile" description="build webstart application jar files">
		<mkdir dir="${site.dir}/lib"/>
		<jar destfile="${site.dir}/lib/jlm-webstart.jar" filesetmanifest="mergewithoutmain">
			<manifest>
				<attribute name="Built-By" value="M. Quinson and G. Oster" />
				<attribute name="Main-Class" value="jlm.ui.JavaLearningMachine" />
				<attribute name="Class-Path" value="." />
			</manifest>
			<fileset dir="${classes.dir}" excludes="**/.gitignore **/*.java **/*.css **/*.html"/>
			<fileset dir="${src.dir}" includes="**/*.java **/*.html **/*.css **/*.map **/*.png" excludes="**/.gitignore"/> 
			<fileset dir="${lib.dir}" excludes="*.jar"/>
		</jar>
		<copy todir="${site.dir}/lib">
			<fileset dir="${lib.dir}">
				<include name="*.jar"/>
			</fileset>
		</copy>
		<signjar alias="${keystore.alias}" keystore="${keystore.file}" storepass="${keystore.passwd}" lazy="true">
		  <path>
		    <fileset dir="${site.dir}/lib" includes="**/*.jar" />
		  </path>
		</signjar>
	</target>
	
</project>
